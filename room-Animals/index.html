 <!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Animals — Virtual Art Gallery of CJ Murphy</title>
<style>
  :root{
    --bg1:#0f1720; --bg2:#0b141a; --accentGlow: rgba(72,200,140,.14);
    --frame:#1a1f26; --mat:#141a20; --mat-edge:#2b313a;
    --ink:#eef6f3; --muted:#bfe4d3; --subtle:#9ed5c0;
    --tile-shadow: 0 18px 40px rgba(0,0,0,.35);
  }
  *{box-sizing:border-box}
  body{
    margin:0; color:var(--ink);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background:
      radial-gradient(900px 600px at 80% 15%, var(--accentGlow), transparent 60%),
      radial-gradient(1000px 700px at 20% 80%, var(--accentGlow), transparent 65%),
      linear-gradient(180deg, var(--bg1), var(--bg2));
    min-height:100svh;
  }

  header{ text-align:center; padding:28px 16px 10px }
  header h1{ margin:0; font-size:clamp(22px,3.5vw,34px) }
  header p{ margin:6px 0 0; color:var(--muted) }
  .actions{ display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin:16px 0 26px }
  .btn,.linkbtn{
    background:#111923; color:#e8fff5; border:1px solid #3a4856;
    padding:10px 14px; border-radius:10px; font-size:.95rem; cursor:pointer; text-decoration:none;
  }
  .btn:hover,.linkbtn:hover{ background:#1a2330; }

  .shell{ max-width:1200px; margin:0 auto; padding:0 18px 72px }

  /* Grid of cards; we’ll still auto-fit but we’ll ALSO do a row-wise pass in JS */
  .cards{ display:grid; grid-template-columns: repeat(auto-fit, minmax(520px, 1fr)); gap:34px; }

  /* Card uses areas so we can flip label side with a class */
  .card{
    --leftW: 380px;            /* default “art” width column */
    --lift: 0px;               /* vertical offset applied when staggered */
    display:grid; gap:22px; align-items:start;
    grid-template-columns: var(--leftW) 1fr;
    grid-template-areas: "frame meta";
    margin-top: var(--lift);
  }
  .card.flip{
    grid-template-columns: 1fr var(--leftW);
    grid-template-areas: "meta frame";
  }
  .frame{ grid-area: frame; }
  .meta { grid-area: meta; }

  @media (max-width: 860px){
    .card, .card.flip{
      grid-template-columns: 1fr;
      grid-template-areas:
        "frame"
        "meta";
      margin-top: 0 !important;   /* disable staggering on small screens */
    }
  }

  /* ---------- FRAMES (base + finishes you already liked) ---------- */
  .frame{
    --tilt: 0deg;
    position:relative; display:block; cursor:pointer;
    border:10px solid var(--frame); border-radius:18px;
    background:linear-gradient(180deg, #0e141a, #151d24);
    box-shadow: var(--tile-shadow), 0 0 0 1px rgba(255,255,255,.05) inset;
    transition: transform .22s ease, box-shadow .22s ease;
    overflow:hidden;
    transform: rotate(var(--tilt));
  }
  .frame::before{
    content:""; position:absolute; inset:8px; border-radius:14px;
    background: radial-gradient(120% 130% at 50% 50%, var(--mat) 0%, #0e151c 60%);
    box-shadow: inset 0 0 0 1px var(--mat-edge), inset 0 10px 20px rgba(0,0,0,.45);
  }
  .tile{ position:relative; aspect-ratio: var(--ar, 4/3); border-radius:12px; overflow:hidden; margin:12px; z-index:1; }
  .tile img{ width:100%; height:100%; object-fit:contain; object-position:center; display:block; transition: transform .25s ease; background:#0e151c; }
  .frame:hover{ transform: rotate(var(--tilt)) translateY(-4px) scale(1.02); box-shadow: 0 22px 54px rgba(0,0,0,.55), 0 0 0 1px rgba(255,255,255,.06) inset }

  /* Shapes */
  .shape-a .frame{ border-radius:28px }
  .shape-a .frame::before, .shape-a .tile{ border-radius:22px }
  .shape-b .frame{ border-radius:14px 28px 18px 32px }
  .shape-b .frame::before, .shape-b .tile{ border-radius:10px 22px 14px 26px }
  .shape-c .frame{ border-radius:40px }
  .shape-c .frame::before, .shape-c .tile{ border-radius:30px }
  .shape-d .frame{ border-radius:18px; }
  .shape-d .frame::before{ box-shadow: inset 0 0 0 2px rgba(255,255,255,.06), inset 0 20px 24px rgba(0,0,0,.5) }
  .shape-e .frame{ border-radius:18px 18px 48px 18px }
  .shape-e .frame::before, .shape-e .tile{ border-radius:12px 12px 36px 12px }
  .shape-f .frame{ border-radius:22px; }

  /* Finishes */
  .finish-gilded .frame{
    border:12px solid transparent;
    background:
      linear-gradient(180deg,#0e141a,#151d24) padding-box,
      conic-gradient(from 20deg,
        #6b4e0f, #caa54b 12%, #ffeb9c 24%, #d3ab4a 36%,
        #6b4e0f 48%, #e2c266 60%, #fff1b5 72%, #c3972e 84%, #6b4e0f) border-box;
    box-shadow: var(--tile-shadow), 0 10px 24px rgba(250,210,120,.12);
  }
  .finish-brass .frame{
    border:10px solid transparent;
    background:
      linear-gradient(180deg,#0e141a,#151d24) padding-box,
      conic-gradient(from -30deg,#3c2e14,#b49352,#6f582b,#d7b778,#4a3a18,#b49352) border-box;
    filter: saturate(1.1);
  }
  .finish-ebony .frame{
    border-color:#0c0f14;
    background:
      linear-gradient(180deg,#0c1016,#161c24) padding-box,
      linear-gradient(145deg, #1e252d, #0a0e13 60%, #1c232c) border-box;
    box-shadow: var(--tile-shadow), 0 12px 28px rgba(0,0,0,.6);
  }
  .finish-walnut .frame{
    border:10px solid transparent;
    background:
      linear-gradient(180deg,#0e141a,#151d24) padding-box,
      linear-gradient(25deg, #3b2414 0%, #5a3820 30%, #7a4b2b 55%, #4b2d19 80%, #3b2414 100%) border-box;
    box-shadow: var(--tile-shadow), 0 10px 26px rgba(80,40,20,.35);
  }
  .finish-verdigris .frame{
    border:10px solid transparent;
    background:
      linear-gradient(180deg,#0e141a,#151d24) padding-box,
      conic-gradient(#0e3b3b, #1b6a6b, #2a8f8c, #1a5e5f, #0e3b3b) border-box;
    box-shadow: var(--tile-shadow), 0 10px 26px rgba(34,170,160,.18);
  }

  /* Sizes (left media column width) */
  .size-s{ --leftW: 320px; }
  .size-m{ --leftW: 380px; } /* default */
  .size-l{ --leftW: 460px; }

  /* Meta text */
  .meta h3{ margin:2px 0 6px; font-size:1.15rem; font-weight:700; color:#fff; }
  .meta .sub{ margin:0 0 12px; color:var(--subtle); font-size:.95rem; }
  .meta p{ margin:0; color:#e5fff7; line-height:1.45; }

  /* Lightbox */
  .lightbox{ position:fixed; inset:0; display:none; place-items:center; background: rgba(3,6,12,.86); z-index:60; }
  .lightbox.open{ display:grid; }
  .lightbox img{ max-width:min(96vw,1600px); max-height:92vh; border-radius:12px; box-shadow:0 24px 80px rgba(0,0,0,.6) }
  .closeBtn{ position:fixed; top:16px; right:18px; z-index:61; background:#111923; color:#fff; border:1px solid #3a4856; padding:10px 14px; border-radius:10px; cursor:pointer; }

  /* Missing overlay */
  .missing{
    position:absolute; inset:8px; display:grid; place-items:center;
    border:2px dashed #ff9a9a; color:#ffd0d0; background:#2a2f3a;
    border-radius:12px; font-size:.9rem; text-align:center; padding:8px;
  }
</style>
</head>
<body>
  <header>
    <h1>Animals</h1>
    <p>Modern frames with plaques. Hover to peek; click a frame for full size.</p>
    <div class="actions">
      <a href="../index.html" class="linkbtn">← Return to Lobby Map</a>
      <button class="btn" id="btnCapTemplate">Captions Template</button>
      <button class="btn" id="btnCapDownload">Download captions.json</button>
    </div>
  </header>

  <div class="shell">
    <div id="cards" class="cards" aria-live="polite"></div>
  </div>

  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" aria-modal="true" role="dialog">
    <button class="closeBtn" id="closeBtn" aria-label="Close">Close ✕</button>
    <img id="lightImg" alt="">
  </div>

<script>
/* ===== FILENAMES (mixed .png/.PNG ok) ===== */
const FILES = [
  "Screen Shot 2025-09-08 at 8.57.00 AM.png",
  "Screen Shot 2025-09-08 at 8.57.30 AM.png",
  "Screen Shot 2025-09-08 at 8.57.34 AM.png",
  "Screen Shot 2025-09-08 at 8.58.29 AM.png",
  "Screen Shot 2025-09-08 at 9.00.26 AM.png",
  "Screen Shot 2025-09-08 at 9.00.46 AM.png",
  "Screen Shot 2025-09-08 at 9.01.14 AM.png",
  "Screen Shot 2025-09-08 at 9.04.36 AM.png",
  "Screen Shot 2025-09-08 at 9.05.04 AM.png",
  "Screen Shot 2025-09-08 at 9.06.16 AM.png",
  "Screen Shot 2025-09-08 at 9.06.29 AM.PNG",
  "Screen Shot 2025-09-08 at 9.07.13 AM.png",
  "Screen Shot 2025-09-08 at 9.07.45 AM.png",
  "Screen Shot 2025-09-08 at 9.08.34 AM.png"
];

async function loadCaptions(){
  try{
    const r = await fetch('captions.json', {cache:'no-store'});
    if(!r.ok) throw 0;
    const map = await r.json();
    return (map && typeof map === 'object') ? map : {};
  }catch{ return {}; }
}

const ROOM_NAME = "Animals";
const cardsEl = document.getElementById('cards');
const lb = document.getElementById('lightbox');
const lbImg = document.getElementById('lightImg');
const closeBtn = document.getElementById('closeBtn');

const prettyTitle = f => f.replace(/\.[^.]+$/,'').replace(/[_-]+/g,' ').replace(/\s+/g,' ').trim();
const rand = (min,max)=> Math.random()*(max-min)+min;
const choose = arr => arr[Math.floor(Math.random()*arr.length)];

/* PNG/.PNG + encoded-space fallback */
function installSmartFallback(img, rawPath){
  const [base, ext] = rawPath.split(/\.(?=[^.]+$)/);
  const toggled = ext === 'png' ? 'PNG' : ext === 'PNG' ? 'png' : null;
  const encoded = rawPath.replace(/ /g,'%20');
  const tries = [rawPath];
  if (toggled) tries.push(`${base}.${toggled}`);
  if (encoded !== rawPath) tries.push(encoded);
  let i=0;
  img.addEventListener('error', ()=>{ i+=1; if(i<tries.length) img.src = tries[i]; });
}

/* Visual varieties */
const SHAPES   = ['shape-a','shape-b','shape-c','shape-d','shape-e','shape-f'];
const FINISHES = ['finish-gilded','finish-brass','finish-ebony','finish-walnut','finish-verdigris'];
const SIZES    = ['size-s','size-m','size-m','size-l']; // weighted

function buildCard(file, caption){
  const article = document.createElement('article');
  article.className = `card ${choose(SHAPES)} ${choose(FINISHES)} ${choose(SIZES)}`;

  const src   = `img/${file}`;
  const title = caption?.title || prettyTitle(file);
  const desc  = caption?.desc  || "Write a short artist statement or description here.";

  // tiny random tilt
  const tilt = rand(-0.4, 0.4).toFixed(3) + 'deg';

  article.innerHTML = `
    <a href="${src}" class="frame" data-title="${title}" style="--tilt:${tilt}">
      <div class="tile"><img alt="${title}" decoding="async" loading="lazy"></div>
    </a>
    <div class="meta">
      <h3>${title}</h3>
      <p class="sub"><strong>${ROOM_NAME}</strong> · <code>${file}</code></p>
      <p>${desc}</p>
    </div>
  `;

  const tile = article.querySelector('.tile');
  const img  = article.querySelector('img');
  const link = article.querySelector('.frame');

  installSmartFallback(img, src);

  img.addEventListener('load', ()=>{
    const w = img.naturalWidth || 4, h = img.naturalHeight || 3;
    tile.style.setProperty('--ar', `${w} / ${h}`);
  });

  img.addEventListener('error', ()=>{
    // after final retry, show a missing banner
    if (img._failed) return;
    img._failed = true;
    const box = document.createElement('div');
    box.className = 'missing';
    box.innerHTML = 'Missing:<br><small><code>'+ (img.currentSrc || src) +'</code></small>';
    tile.appendChild(box); img.style.display='none';
  });

  img.src = src;

  link.addEventListener('click', (e)=>{
    e.preventDefault();
    lbImg.src = img.currentSrc || src;
    lbImg.alt = title;
    lb.classList.add('open'); document.body.style.overflow='hidden';
  });

  return article;
}

/* Lightbox close */
function closeLightbox(){ lb.classList.remove('open'); lbImg.src=''; document.body.style.overflow=''; }
lb.addEventListener('click', e=>{ if(e.target === lb) closeLightbox(); });
closeBtn.addEventListener('click', closeLightbox);
document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeLightbox(); });

/* --- Label layout engine ---------------------------------------------
   For each visual row:
     - Alternate meta side: left/right
     - For every second card in the row (1, 3, ...), lift it ~½ its art height
       so labels interleave and don’t collide.
-----------------------------------------------------------------------*/
function arrangeLabels(){
  const cards = Array.from(document.querySelectorAll('.card'));
  if (!cards.length) return;

  // Reset
  cards.forEach(c=>{
    c.classList.remove('flip');
    c.style.setProperty('--lift','0px');
  });

  // Group cards by row (same offsetTop within a tolerance)
  const rows = [];
  let current = [], lastTop = null, tol = 4;
  cards.forEach(el=>{
    const top = el.offsetTop;
    if (lastTop === null || Math.abs(top - lastTop) <= tol){
      current.push(el); lastTop = (lastTop===null?top:lastTop);
    }else{
      rows.push(current); current = [el]; lastTop = top;
    }
  });
  if (current.length) rows.push(current);

  // For each row, alternate label side and stagger every second item
  rows.forEach((row, rowIdx)=>{
    row.forEach((card, idx)=>{
      const flip = (idx % 2 === 1);             // label on left for 2nd, 4th, ...
      if (flip) card.classList.add('flip');

      // Apply stagger only if not the first visual row
      if (flip && rowIdx > 0){
        const tile = card.querySelector('.tile');
        const h = tile?.offsetHeight || 0;
        const liftPx = Math.round(h * 0.5);     // raise by ~half art height
        card.style.setProperty('--lift', `-${liftPx}px`);
      }
    });
  });
}

// Debounce for resize and image loads
let t;
function scheduleArrange(){ clearTimeout(t); t = setTimeout(arrangeLabels, 60); }
window.addEventListener('resize', scheduleArrange);

/* Render */
(async function init(){
  const captions = await loadCaptions();
  cardsEl.innerHTML = '';
  FILES.forEach(f => {
    const card = buildCard(f, captions[f]);
    cardsEl.appendChild(card);
    // reflow after each image settles
    const img = card.querySelector('img');
    img.addEventListener('load', scheduleArrange);
    img.addEventListener('error', scheduleArrange);
  });
  scheduleArrange();
})();

/* Captions helpers (remove later if desired) */
document.getElementById('btnCapTemplate')?.addEventListener('click', ()=>{
  const obj = {};
  FILES.forEach(f => { obj[f]={title:prettyTitle(f),desc:"Write a short artist statement or description here."}; });
  const blob = new Blob([JSON.stringify(obj,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = Object.assign(document.createElement('a'), {href:url, download:'captions.json'});
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});
document.getElementById('btnCapDownload')?.addEventListener('click', ()=>{
  const obj = {};
  FILES.forEach(f => { obj[f]={title:prettyTitle(f),desc:"Write a short artist statement or description here."}; });
  const blob = new Blob([JSON.stringify(obj,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = Object.assign(document.createElement('a'), {href:url, download:'captions.json'});
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});
</script>
</body>
</html>
